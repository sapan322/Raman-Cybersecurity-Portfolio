# Malware Analysis Report (RAT.Unknown.exe)

**A Practical Showcase of My Cybersecurity Skills**  

---

## Overview  
**Malware Sample:** *RAT.Unknown.exe*  
**Source:** [*PMAT-labs*](https://github.com/HuskyHacks/PMAT-labs/tree/main)  

**Goal:**  
Analyze the malware's static and dynamic behavior, identify capabilities, and document findings.

**Key Skills Demonstrated:**  
- Static Analysis  
- Dynamic Analysis  
- Threat Detection & Reporting  
- Reverse Engineering (basic level)  

**Tools Used:**  
- **Infrastructure:** Proxmox, FLARE-VM, Remnux, pfSense  
- **Static Analysis:** FLOSS, PE-bear, VirusTotal, pestudio  
- **Dynamic Analysis:** Wireshark, Procmon, INetSim, TCPview, netcat  

---

## Key Findings  

### 1. Static Analysis  

- **Hashes:**  
  - SHA-256: `248D491F89A10EC3289EC4CA448B19384464329C442BAC395F680C4F3A345C8C`  
  - MD5: `689FF2C6F94E31ABBA1DDEBF68BE810E`  
  - **VirusTotal Results:**  
    - Detection score: *47/72*  
    - Screenshot of VirusTotal result (attached below)  

- **Suspicious Strings (FLOSS / strings):**  
  - CreateFileW  
  - GetCurrentProcess  
  - GetCurrentProcessId  
  - GetCurrentThreadId  
  - VirtualAlloc  
  - socket  
  - InternetOpenUrlW  
  - `@AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup`  
  - `NO SOUP FOR YOU` (error message string)  
  - `http://serv1.ec2-102-95-13-2-ubuntu.local`  
  - `/mscordll.exe`  
  - `/msdcorelib.exe`  
  - Several obfuscated and suspicious strings indicating remote control functionality.  

- **PE Analysis (PE-bear):**  
  - Packed / Not packed: *Not packed*  
  - Compile Time (TimeDateStamp): *12.09.2021*  
  - Suspicious imports:  
    - DeleteCriticalSection  
    - EnterCriticalSection  
    - GetCurrentProcess  
    - GetCurrentProcessId  
    - GetCurrentThreadId  
    - GetLastError  
    - GetProcAddress  
    - GetStartupInfoA  
    - GetSystemTimeAsFileTime  
    - GetTickCount  
    - InitializeCriticalSection  
    - LeaveCriticalSection  
    - LoadLibraryA  

---

### 2. Dynamic Analysis  

- **Observed Behavior:**  
  - GUI windows or command prompt visible:  
    - *Yes* if the VM is not connected to the Internet (displays the message "NO SOUP FOR YOU").  
    - *No* if INetSim simulates an Internet connection.  
  - File creation/deletion events:  
    - Created file: `C:\Users\FlareVM\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\mscordll.exe`  
  - Persistence mechanism detected through startup folder execution.  
  - Remote Access Trojan (RAT) behavior detected via injected command execution.   

- **Network Indicators (Wireshark):**  
  - Domains contacted:  
    - `http://serv1.ec2-102-95-13-2-ubuntu.local` (simulated by INetSim)  
  - DNS requests:  
    - `serv1.ec2-102-95-13-2-ubuntu.local`  
  - HTTP requests:  
    - `GET / HTTP/1.1`  
    - `GET /msdcorelib.exe HTTP/1.1`  

- **Host Indicators (Procmon, TCPview):**  
  - Created files:  
    - `C:\Users\FlareVM\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\mscordll.exe`  
  - Persistence mechanism:  
    - File placed in Startup folder to ensure execution on reboot.  
  - Host network indicators:  
    - TCP socket in listening state on `0.0.0.0:5555`.  
    - Upon connection, the host responds with base64-encoded string: `WytdlHdoYXQgY29tbWFuZCBjYW4gSSBydW4gZm9ylHlvdQ==`, which decodes to *"What command can I run for you"*.  
    - The malware executes commands received via this socket, confirming RAT functionality.  

- **Execution Flow:**  
  - If the URL `http://serv1.ec2-102-95-13-2-ubuntu.local` is reachable:  
    - Malware downloads `msdcorelib.exe` and saves it as `mscordll.exe` in the Startup folder for persistence.  
    - Executes the second-stage payload.
    - Create socket on `0.0.0.0:5555` and executes commands received via this socket (RAT) 
  - If the URL is unreachable:  
    - Displays an error message window with the text: *"NO SOUP FOR YOU"*.  

---

## Screenshots  

| Tool                    | Description                                                                 |
|-------------------------|-----------------------------------------------------------------------------|
| ![VirusTotal](https://github.com/sapan322/Raman-Cybersecurity-Portfolio/blob/main/Malware%20Development%20%26%20Analysis/Malware%20Analysis/Reports/screenshots/%232%20VT.png)              | Detection results screenshot                                                |
| ![Strings (FLOSS)](https://github.com/sapan322/Raman-Cybersecurity-Portfolio/blob/main/Malware%20Development%20%26%20Analysis/Malware%20Analysis/Reports/screenshots/%232%20Strings.png)         | Suspicious strings extracted from binary                                    |
| ![PE-bear](https://github.com/sapan322/Raman-Cybersecurity-Portfolio/blob/main/Malware%20Development%20%26%20Analysis/Malware%20Analysis/Reports/screenshots/%232%20UNPACKED.png)                 | Section headers showing binary is not packed                                |
| ![Error message](https://github.com/sapan322/Raman-Cybersecurity-Portfolio/blob/main/Malware%20Development%20%26%20Analysis/Malware%20Analysis/Reports/screenshots/%232%20NoSoup.png)           | Screenshot of "NO SOUP FOR YOU" popup                                       |
| ![Wireshark](https://github.com/sapan322/Raman-Cybersecurity-Portfolio/blob/main/Malware%20Development%20%26%20Analysis/Malware%20Analysis/Reports/screenshots/%232%20HTTP%20GET.png)               | Captured HTTP GET request for `/msdcorelib.exe`                             |
| ![Procmon](https://github.com/sapan322/Raman-Cybersecurity-Portfolio/blob/main/Malware%20Development%20%26%20Analysis/Malware%20Analysis/Reports/screenshots/%232%20CREATE%20FILE.png)                 | File creation of `mscordll.exe` in the Startup folder                       |
| ![TCPview](https://github.com/sapan322/Raman-Cybersecurity-Portfolio/blob/main/Malware%20Development%20%26%20Analysis/Malware%20Analysis/Reports/screenshots/%232%20TCPview.png)                 | RAT listening on `0.0.0.0:5555`                                             |
| ![Netcat interaction](https://github.com/sapan322/Raman-Cybersecurity-Portfolio/blob/main/Malware%20Development%20%26%20Analysis/Malware%20Analysis/Reports/screenshots/%232%20NC%20Answer.png)      | Screenshot showing base64-encoded response from the socket                  |
| ![Command injection proof](https://github.com/sapan322/Raman-Cybersecurity-Portfolio/blob/main/Malware%20Development%20%26%20Analysis/Malware%20Analysis/Reports/screenshots/%232%20Command%20injection%20Remote%20Access.png) | Demonstration of remote command execution on the infected host via TCP 5555 |

---

## Indicators of Compromise (IOCs)  

- **File paths:**  
  - `C:\Users\FlareVM\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\mscordll.exe`  

- **Network IOCs:**  
  - Domains:  
    - `http://serv1.ec2-102-95-13-2-ubuntu.local`  
  - Sockets:  
    - Listening on `0.0.0.0:5555` and executing commands received through that socket.  

---

## Key Takeaways  

- **Skill Development:**  
  - Learned how to detect persistence mechanisms using autorun locations.  
  - Improved understanding of identifying C2 (Command & Control) behavior via TCP listeners and encoded communications.  
  - Strengthened experience with simulating Internet connectivity to safely observe malware behavior using INetSim.  

- **Challenges Overcome:**  
  - Encountered difficulties in capturing command injections and understanding socket communications; resolved by setting up a controlled netcat listener.  
  - Troubleshooting simulated DNS responses in INetSim to ensure the malware reached its intended destination.  

- **Real-World Relevance:**  
  - Demonstrates the ability to detect stealthy RATs that utilize local persistence, encoded communication, and socket-based command injection techniquesâ€”critical skills for SOC analysts and threat hunters.  

---

## For Employers  

This report illustrates my ability to:  
- Set up a secure and isolated malware analysis lab (Proxmox, FLARE-VM, Remnux, pfSense)  
- Perform both static and dynamic analysis of unknown malware  
- Identify indicators of compromise (IOCs) and document them professionally  
- Simulate real-world scenarios to observe multi-stage payload delivery  
- Communicate findings clearly and concisely in a structured report  

---

**View this and other projects on my GitHub:**  
[My Cybersecurity Portfolio](https://github.com/sapan322/Raman-Cybersecurity-Portfolio/tree/main)

